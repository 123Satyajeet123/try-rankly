ğŸ“‹ [LLM MODELS] Configured: {
  openai: 'openai/gpt-4o',
  gemini: 'google/gemini-2.5-flash',
  claude: 'anthropic/claude-3.5-sonnet',
  perplexity: 'perplexity/sonar-pro'
}
ğŸ§ª PromptTestingService initialized (deterministic scoring)
ğŸ“Š MetricsAggregationService initialized
ğŸš€ Rankly Backend API running on port 5000
ğŸ“Š Health check: http://localhost:5000/health
ğŸ“š API info: http://localhost:5000/api
ğŸŒ Environment: development
ğŸ”— Frontend URL: http://localhost:3000
âœ… MongoDB connected

ğŸ§¹ Running startup cleanup...

ğŸ§¹ [CLEANUP] Starting orphaned prompts cleanup...
ğŸ“Š [CLEANUP] Found 30 topics and 19 personas
âŒ [CLEANUP] Found 0 orphaned prompts
âœ… [CLEANUP] Orphaned prompts cleanup complete


ğŸ§¹ [CLEANUP] Starting orphaned test results cleanup...
âŒ [CLEANUP] Found 0 orphaned test results
âœ… [CLEANUP] Orphaned test results cleanup complete

âœ… Startup cleanup complete


======================================================================
ğŸ§ª [API ENDPOINT] POST /api/prompts/test
ğŸ‘¤ User ID: 68e7ef58da34c5124ad5fb1c
â° Request time: 2025-10-09T18:39:07.831Z
======================================================================

ğŸ” [VALIDATION] Checking for existing prompts...
âœ… [VALIDATION] Found 30 active prompts
ğŸ“Š [START] Testing prompts across 4 LLMs (limited to 2 for testing)...

============================================================
ğŸ¯ [TEST START] Starting prompt testing for user: 68e7ef58da34c5124ad5fb1c
ğŸ“… Timestamp: 2025-10-09T18:39:07.856Z
============================================================

ğŸ” [QUERY] Fetching active prompts for user 68e7ef58da34c5124ad5fb1c...
ğŸ” [FILTER] Only fetching prompts with topicId, personaId, and queryType
âš ï¸  [TESTING MODE] Limited to 2 prompts to save API costs
âœ… [QUERY] Found 2 prompts in database
ğŸ“Š [INFO] Prompts breakdown:
   1. What makes Stripe a good choice for payment proces...
      Raw topicId type: object, value: {
  _id: new ObjectId('68e7ff845786bb21b244432f'),
  userId: new ObjectId('68e7ef58da34c5124ad5fb1c'),
  name: 'Global Payment Processing',
  selected: true,
  description: "Stripe's core service is enabling businesses to accept and optimize payments worldwide, supporting 135+ currencies and local payment methods for higher conversion rates.",
  keywords: [
    'global payments',
    'multi-currency',
    'payment processing',
    'local payment methods',
    'cross-border payments'
  ],
  priority: 'High',
  source: 'ai',
  promptCount: 10,
  createdAt: 2025-10-09T18:31:32.234Z,
  updatedAt: 2025-10-09T18:31:48.686Z,
  __v: 0
}
      Raw personaId type: object, value: {
  _id: new ObjectId('68e7ff845786bb21b244433f'),
  userId: new ObjectId('68e7ef58da34c5124ad5fb1c'),
  type: 'E-commerce Business Owner',
  description: 'Responsible for managing online sales and ensuring smooth payment processing. They face challenges in integrating payment systems, managing subscriptions, and preventing fraud. They use Stripe for secure payment processing, subscription management, and fraud prevention tools.',
  selected: true,
  painPoints: [
    'Complex payment integration',
    'Subscription management',
    'Fraud prevention'
  ],
  goals: [
    'Streamline payment processes',
    'Increase revenue through subscriptions',
    'Reduce fraud losses'
  ],
  relevance: 'High',
  source: 'ai',
  createdAt: 2025-10-09T18:31:32.490Z,
  updatedAt: 2025-10-09T18:31:32.491Z,
  __v: 0
}
      Topic: Global Payment Processing (ID: 68e7ff845786bb21b244432f)
      Persona: E-commerce Business Owner (ID: 68e7ff845786bb21b244433f)
      QueryType: Navigational
   2. What are the best global payment processing soluti...
      Raw topicId type: object, value: {
  _id: new ObjectId('68e7ff845786bb21b244432f'),
  userId: new ObjectId('68e7ef58da34c5124ad5fb1c'),
  name: 'Global Payment Processing',
  selected: true,
  description: "Stripe's core service is enabling businesses to accept and optimize payments worldwide, supporting 135+ currencies and local payment methods for higher conversion rates.",
  keywords: [
    'global payments',
    'multi-currency',
    'payment processing',
    'local payment methods',
    'cross-border payments'
  ],
  priority: 'High',
  source: 'ai',
  promptCount: 10,
  createdAt: 2025-10-09T18:31:32.234Z,
  updatedAt: 2025-10-09T18:31:48.686Z,
  __v: 0
}
      Raw personaId type: object, value: {
  _id: new ObjectId('68e7ff845786bb21b244433f'),
  userId: new ObjectId('68e7ef58da34c5124ad5fb1c'),
  type: 'E-commerce Business Owner',
  description: 'Responsible for managing online sales and ensuring smooth payment processing. They face challenges in integrating payment systems, managing subscriptions, and preventing fraud. They use Stripe for secure payment processing, subscription management, and fraud prevention tools.',
  selected: true,
  painPoints: [
    'Complex payment integration',
    'Subscription management',
    'Fraud prevention'
  ],
  goals: [
    'Streamline payment processes',
    'Increase revenue through subscriptions',
    'Reduce fraud losses'
  ],
  relevance: 'High',
  source: 'ai',
  createdAt: 2025-10-09T18:31:32.490Z,
  updatedAt: 2025-10-09T18:31:32.491Z,
  __v: 0
}
      Topic: Global Payment Processing (ID: 68e7ff845786bb21b244432f)
      Persona: E-commerce Business Owner (ID: 68e7ff845786bb21b244433f)
      QueryType: Commercial Investigation

ğŸ”— [URL] Fetching latest URL analysis...
âœ… [URL] Found URL analysis: https://stripe.com (ID: 68e7ff845786bb21b244430f)

ğŸ¢ [CONTEXT] Fetching brand context for scoring...
âœ… [CONTEXT] Brand: Stripe, Competitors: 3

ğŸ”„ [BATCHING] Processing 2 prompts in 1 batches (size: 2)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ [BATCH 1/1] Processing 2 prompts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ”¬ [PROMPT] Testing: "What makes Stripe a good choice for payment processing?..."
   Prompt ID: 68e7ff935786bb21b2444368
   Query Type: Navigational
   Topic ID: 68e7ff845786bb21b244432f
   Persona ID: 68e7ff845786bb21b244433f
   ğŸš€ [STEP 1] Sending to 4 LLMs in parallel...
      ğŸŒ [API] Calling openai (openai/gpt-4o)...
      ğŸŒ [API] Calling gemini (google/gemini-2.5-flash)...
      ğŸŒ [API] Calling claude (anthropic/claude-3.5-sonnet)...
      ğŸŒ [API] Calling perplexity (perplexity/sonar-pro)...

ğŸ”¬ [PROMPT] Testing: "What are the best global payment processing solutions for e-..."
   Prompt ID: 68e7ff935786bb21b244436a
   Query Type: Commercial Investigation
   Topic ID: 68e7ff845786bb21b244432f
   Persona ID: 68e7ff845786bb21b244433f
   ğŸš€ [STEP 1] Sending to 4 LLMs in parallel...
      ğŸŒ [API] Calling openai (openai/gpt-4o)...
      ğŸŒ [API] Calling gemini (google/gemini-2.5-flash)...
      ğŸŒ [API] Calling claude (anthropic/claude-3.5-sonnet)...
      ğŸŒ [API] Calling perplexity (perplexity/sonar-pro)...
      ğŸ“ [CITATIONS] Extracted 28 citations from gemini
      âœ… [API] gemini responded in 6789ms (1167 tokens, 4707 chars, 28 citations)
      ğŸ“ [CITATIONS] Extracted 17 citations from gemini
      âœ… [API] gemini responded in 6823ms (1187 tokens, 4590 chars, 17 citations)
      ğŸ“ [CITATIONS] Extracted 18 citations from perplexity
      âœ… [API] perplexity responded in 9245ms (762 tokens, 2839 chars, 18 citations)
      ğŸ“ [CITATIONS] Extracted 6 citations from openai
      âœ… [API] openai responded in 10055ms (668 tokens, 2635 chars, 6 citations)
      ğŸ“ [CITATIONS] Extracted 16 citations from openai
      âœ… [API] openai responded in 14605ms (918 tokens, 3417 chars, 16 citations)
      ğŸ“ [CITATIONS] Extracted 14 citations from claude
      âœ… [API] claude responded in 18087ms (710 tokens, 1973 chars, 14 citations)
      ğŸ“ [CITATIONS] Extracted 32 citations from claude
      âœ… [API] claude responded in 18314ms (835 tokens, 2652 chars, 32 citations)
   âœ… [STEP 1] LLM calls complete in 18.33s (4/4 successful)
   ğŸ¯ [STEP 2] Scoring 4 responses...
   ğŸ“ [OPENAI] Response received (10055ms, 668 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 1, Citations: 6
      ğŸ“Š [SCORING] Scores - Visibility: 100, Overall: 100
   âœ… [OPENAI] Score calculated - Visibility: 100/100, Overall: 100/100
      ğŸ’¾ [SAVE] Preparing to save test result for openai
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Navigational
      ğŸ“Š [SAVE] Extracted 1 brand entries with complete metrics
   ğŸ“ [GEMINI] Response received (6789ms, 1167 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 1, Citations: 28
      ğŸ“Š [SCORING] Scores - Visibility: 100, Overall: 100
   âœ… [GEMINI] Score calculated - Visibility: 100/100, Overall: 100/100
      ğŸ’¾ [SAVE] Preparing to save test result for gemini
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Navigational
      ğŸ“Š [SAVE] Extracted 1 brand entries with complete metrics
   ğŸ“ [CLAUDE] Response received (18314ms, 835 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 1, Citations: 26
      ğŸ“Š [SCORING] Scores - Visibility: 100, Overall: 100
   âœ… [CLAUDE] Score calculated - Visibility: 100/100, Overall: 100/100
      ğŸ’¾ [SAVE] Preparing to save test result for claude
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Navigational
      ğŸ“Š [SAVE] Extracted 4 brand entries with complete metrics
   ğŸ“ [PERPLEXITY] Response received (9245ms, 762 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 1, Citations: 18
      ğŸ“Š [SCORING] Scores - Visibility: 100, Overall: 100
   âœ… [PERPLEXITY] Score calculated - Visibility: 100/100, Overall: 100/100
      ğŸ’¾ [SAVE] Preparing to save test result for perplexity
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Navigational
      ğŸ“Š [SAVE] Extracted 1 brand entries with complete metrics
      âœ… [SAVE] Test result saved successfully with 1 brand metrics
   ğŸ’¾ [OPENAI] Saved to database (ID: 68e8015ec9dc0cdb11cbc82b)
      âœ… [SAVE] Test result saved successfully with 4 brand metrics
   ğŸ’¾ [CLAUDE] Saved to database (ID: 68e8015ec9dc0cdb11cbc87f)
      âœ… [SAVE] Test result saved successfully with 1 brand metrics
   ğŸ’¾ [PERPLEXITY] Saved to database (ID: 68e8015ec9dc0cdb11cbc8af)
      âœ… [SAVE] Test result saved successfully with 1 brand metrics
   ğŸ’¾ [GEMINI] Saved to database (ID: 68e8015ec9dc0cdb11cbc842)
   âœ… [STEP 2] Scoring complete in 0.13s (4/4 successful)
   âœ¨ [COMPLETE] Prompt testing finished

      ğŸ“ [CITATIONS] Extracted 24 citations from perplexity
      âœ… [API] perplexity responded in 25981ms (1154 tokens, 4312 chars, 24 citations)
   âœ… [STEP 1] LLM calls complete in 25.99s (4/4 successful)
   ğŸ¯ [STEP 2] Scoring 4 responses...
   ğŸ“ [OPENAI] Response received (14605ms, 918 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 9, Citations: 2
      ğŸ“Š [SCORING] Scores - Visibility: 94, Overall: 94
   âœ… [OPENAI] Score calculated - Visibility: 94/100, Overall: 94/100
      ğŸ’¾ [SAVE] Preparing to save test result for openai
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Commercial Investigation
      ğŸ“Š [SAVE] Extracted 4 brand entries with complete metrics
   ğŸ“ [GEMINI] Response received (6823ms, 1187 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 5, Citations: 8
      ğŸ“Š [SCORING] Scores - Visibility: 96, Overall: 96
   âœ… [GEMINI] Score calculated - Visibility: 96/100, Overall: 96/100
      ğŸ’¾ [SAVE] Preparing to save test result for gemini
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Commercial Investigation
      ğŸ“Š [SAVE] Extracted 3 brand entries with complete metrics
   ğŸ“ [CLAUDE] Response received (18087ms, 710 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 2, Citations: 2
      ğŸ“Š [SCORING] Scores - Visibility: 84, Overall: 84
   âœ… [CLAUDE] Score calculated - Visibility: 84/100, Overall: 84/100
      ğŸ’¾ [SAVE] Preparing to save test result for claude
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Commercial Investigation
      ğŸ“Š [SAVE] Extracted 4 brand entries with complete metrics
   ğŸ“ [PERPLEXITY] Response received (25981ms, 1154 tokens)
      ğŸ¯ [SCORING] Calculating deterministic score for: Stripe
      ğŸ“Š [SCORING] Metrics - Brand: Stripe, Mentioned: true, Position: 1, Citations: 2
      ğŸ“Š [SCORING] Scores - Visibility: 99, Overall: 99
   âœ… [PERPLEXITY] Score calculated - Visibility: 99/100, Overall: 99/100
      ğŸ’¾ [SAVE] Preparing to save test result for perplexity
      ğŸ“‹ [SAVE] Extracted IDs - topicId: 68e7ff845786bb21b244432f, personaId: 68e7ff845786bb21b244433f, queryType: Commercial Investigation
      ğŸ“Š [SAVE] Extracted 4 brand entries with complete metrics
      âœ… [SAVE] Test result saved successfully with 4 brand metrics
   ğŸ’¾ [OPENAI] Saved to database (ID: 68e80165c9dc0cdb11cbc8d3)
      âœ… [SAVE] Test result saved successfully with 4 brand metrics
   ğŸ’¾ [CLAUDE] Saved to database (ID: 68e80165c9dc0cdb11cbc913)
      âœ… [SAVE] Test result saved successfully with 3 brand metrics
   ğŸ’¾ [GEMINI] Saved to database (ID: 68e80165c9dc0cdb11cbc8f0)
      âœ… [SAVE] Test result saved successfully with 4 brand metrics
   ğŸ’¾ [PERPLEXITY] Saved to database (ID: 68e80166c9dc0cdb11cbc92a)
   âœ… [STEP 2] Scoring complete in 0.09s (4/4 successful)
   âœ¨ [COMPLETE] Prompt testing finished

âœ… [BATCH 1] Complete in 26.09s - Success: 8, Failed: 0

ğŸ“Š [SUMMARY] Calculating aggregate statistics...
   ğŸ“Š [CALC] Valid results: 8, Completed: 8

============================================================
âœ… [TEST COMPLETE] All testing finished
ğŸ“Š Total Tests: 8
âœ… Completed: 8
âŒ Failed: 0
ğŸ“ˆ Avg Visibility: 97%
ğŸ¯ Brand Mention Rate: 100%
ğŸ† Best LLM: perplexity
============================================================


======================================================================
âœ… [API RESPONSE] Testing complete
â±ï¸  Total duration: 26.23s
ğŸ“Š Results: 8/8 successful
======================================================================

