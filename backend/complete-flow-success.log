ğŸ”‘ OpenRouter API Key loaded: YES
ğŸ“‹ [LLM MODELS] Configured: {
  openai: 'openai/gpt-4o',
  gemini: 'google/gemini-2.5-flash',
  claude: 'anthropic/claude-3.5-sonnet',
  perplexity: 'perplexity/sonar-pro'
}
ğŸ§ª PromptTestingService initialized (deterministic scoring)
ğŸ“Š MetricsAggregationService initialized

================================================================================
ğŸš€ COMPLETE BACKEND FLOW TEST - NEW METRICS SYSTEM
================================================================================

âœ… Connected to MongoDB

ğŸ“‹ SETUP: Test User

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… Using test user: satyajeetdas225@gmail.com
ğŸ§¹ Cleaning up old test data...
âœ… Cleanup complete

User ID: 68e7ef58da34c5124ad5fb1c

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š STEP 1: URL ANALYSIS

================================================================================

Analyzing: https://stripe.com
Using: Perplexity AI (perplexity/sonar-pro)

ğŸ” Starting website analysis for: https://stripe.com
ğŸ“„ Scraping website: https://stripe.com
âŒ Scraping failed: page.waitForTimeout is not a function
ğŸ”„ Attempting fallback scraping method...
âœ… Fallback scraping successful
ğŸ¤– Starting AI analysis...
âœ… Successfully parsed topics analysis
   Raw data keys: topics
   Normalized keys: topics
   Topics count: 8
âœ… Successfully parsed competitors analysis
   Raw data keys: competitors
   Normalized keys: competitors
   Competitors count: 6
âœ… Successfully parsed brandContext analysis
   Raw data keys: companyName, industry, businessModel, targetMarket, valueProposition, keyServices, brandTone, marketPosition
   Normalized keys: companyName, industry, businessModel, targetMarket, valueProposition, keyServices, brandTone, marketPosition
âœ… Successfully parsed personas analysis
   Raw data keys: personas
   Normalized keys: personas
   Personas count: 4
âœ… Website analysis completed successfully
âœ… Analysis Complete!

âœ… Saved UrlAnalysis to database
âœ… Saved 6 competitors
âœ… Saved 8 topics
âœ… Saved 4 personas

ğŸ“Š Analysis Summary:
Brand: Stripe
Description: undefined...
Competitors: 6
Topics: 8
Personas: 4

Analysis ID: 68e8e3a81aa1038756694c85

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š STEP 2: USER SELECTIONS

================================================================================

Found 3 competitors to select
âœ… Selected competitor: PayPal
âœ… Selected competitor: Authorize.net
âœ… Selected competitor: GoCardless
Found 2 topics to select
âœ… Selected topic: Revenue and Finance Automation
âœ… Selected topic: Global Payments and Multi-Currency Support
Found 2 personas to select
âœ… Selected persona: Startup Founder / Entrepreneur
âœ… Selected persona: Marketplace / Platform Operator

â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€
â”€

ğŸ“Š STEP 3: PROMPT GENERATION

================================================================================

Generating prompts for 2 topics Ã— 2 personas = 4 combinations...

ğŸ¯ Starting prompt generation...
Topics: 2, Personas: 2
Generating prompts for: Revenue and Finance Automation Ã— Startup Founder / Entrepreneur
ğŸ” Topic object: {
  id: '68e8e3a81aa1038756694ca6',
  _id: new ObjectId('68e8e3a81aa1038756694ca6'),
  name: 'Revenue and Finance Automation'
}
ğŸ” Persona object: {
  id: '68e8e3a91aa1038756694cb5',
  _id: new ObjectId('68e8e3a91aa1038756694cb5'),
  type: 'Startup Founder / Entrepreneur'
}
ğŸ” Prompt generation context for Revenue and Finance Automation Ã— Startup Founder / Entrepreneur:
   Brand: Stripe
   URL: https://stripe.com
ğŸ” Generated prompts for topic-persona combination: {
  topicId: new ObjectId('68e8e3a81aa1038756694ca6'),
  topicName: 'Revenue and Finance Automation',
  personaId: new ObjectId('68e8e3a91aa1038756694cb5'),
  personaType: 'Startup Founder / Entrepreneur',
  promptCount: 5
}
Generating prompts for: Revenue and Finance Automation Ã— Marketplace / Platform Operator
ğŸ” Topic object: {
  id: '68e8e3a81aa1038756694ca6',
  _id: new ObjectId('68e8e3a81aa1038756694ca6'),
  name: 'Revenue and Finance Automation'
}
ğŸ” Persona object: {
  id: '68e8e3a91aa1038756694cb8',
  _id: new ObjectId('68e8e3a91aa1038756694cb8'),
  type: 'Marketplace / Platform Operator'
}
ğŸ” Prompt generation context for Revenue and Finance Automation Ã— Marketplace / Platform Operator:
   Brand: Stripe
   URL: https://stripe.com
ğŸ” Generated prompts for topic-persona combination: {
  topicId: new ObjectId('68e8e3a81aa1038756694ca6'),
  topicName: 'Revenue and Finance Automation',
  personaId: new ObjectId('68e8e3a91aa1038756694cb8'),
  personaType: 'Marketplace / Platform Operator',
  promptCount: 5
}
Generating prompts for: Global Payments and Multi-Currency Support Ã— Startup Founder / Entrepreneur
ğŸ” Topic object: {
  id: '68e8e3a81aa1038756694ca5',
  _id: new ObjectId('68e8e3a81aa1038756694ca5'),
  name: 'Global Payments and Multi-Currency Support'
}
ğŸ” Persona object: {
  id: '68e8e3a91aa1038756694cb5',
  _id: new ObjectId('68e8e3a91aa1038756694cb5'),
  type: 'Startup Founder / Entrepreneur'
}
ğŸ” Prompt generation context for Global Payments and Multi-Currency Support Ã— Startup Founder / Entrepreneur:
   Brand: Stripe
   URL: https://stripe.com
ğŸ” Generated prompts for topic-persona combination: {
  topicId: new ObjectId('68e8e3a81aa1038756694ca5'),
  topicName: 'Global Payments and Multi-Currency Support',
  personaId: new ObjectId('68e8e3a91aa1038756694cb5'),
  personaType: 'Startup Founder / Entrepreneur',
  promptCount: 5
}
Generating prompts for: Global Payments and Multi-Currency Support Ã— Marketplace / Platform Operator
ğŸ” Topic object: {
  id: '68e8e3a81aa1038756694ca5',
  _id: new ObjectId('68e8e3a81aa1038756694ca5'),
  name: 'Global Payments and Multi-Currency Support'
}
ğŸ” Persona object: {
  id: '68e8e3a91aa1038756694cb8',
  _id: new ObjectId('68e8e3a91aa1038756694cb8'),
  type: 'Marketplace / Platform Operator'
}
ğŸ” Prompt generation context for Global Payments and Multi-Currency Support Ã— Marketplace / Platform Operator:
   Brand: Stripe
   URL: https://stripe.com
ğŸ” Generated prompts for topic-persona combination: {
  topicId: new ObjectId('68e8e3a81aa1038756694ca5'),
  topicName: 'Global Payments and Multi-Currency Support',
  personaId: new ObjectId('68e8e3a91aa1038756694cb8'),
  personaType: 'Marketplace / Platform Operator',
  promptCount: 5
}
âœ… Generated 20 prompts successfully
âœ… Generated 20 prompts

Sample prompt data: {
  "topicId": "68e8e3a81aa1038756694ca6",
  "topicName": "Revenue and Finance Automation",
  "personaId": "68e8e3a91aa1038756694cb5",
  "personaType": "Startup Founder / Entrepreneur",
  "promptText": "What is Stripe and how can it help my startup streamline payments?",
  "promptIndex": 1,
  "queryType": "Navigational"
}
âœ… Saved 20 prompts to database

Sample prompts:

1. What is Stripe and how can it help my startup streamline payments?...

âŒ ERROR: Cannot read properties of undefined (reading 'topic')
TypeError: Cannot read properties of undefined (reading 'topic')
    at /home/jeet/rankly/tryrankly/backend/test-complete-flow-new-metrics.js:286:44
    at Array.forEach (<anonymous>)
    at runCompleteFlow (/home/jeet/rankly/tryrankly/backend/test-complete-flow-new-metrics.js:284:32)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Disconnected from MongoDB
